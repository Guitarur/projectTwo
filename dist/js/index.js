var control,timer,root=window.player,songList=[],newIndex=0,len=0,audio=root.audioManager,like=root.like;function getData(o){$.ajax({type:"GET",url:o,success:function(o){len=(songList=o).length,control=new root.control(len,newIndex),root.songList.renderList(o),bindEvent(),bindTouch(),$("body").trigger("play:change",0)},error:function(){}})}function bindEvent(){$("body").on("play:change",function(o,t){root.render(songList[t]),audio.getAudio(songList[t].audio),root.pro.renderAlltime(songList[t].duration),newIndex=t,"play"==audio.status&&(audio.play(),rotate(0)),$(".img-box").attr("data-deg",0),$(".img-box").css({transform:"rotateZ(0deg)",transition:"none"})}),$(".pre").on("click",function(){var o=control.pre();$("body").trigger("play:change",o),root.pro.start(0),"pause"==audio.status&&audio.pause(),root.pro.stop()}),$(".next").on("click",function(){var o=control.next();$("body").trigger("play:change",o),root.pro.start(0),"pause"==audio.status&&audio.pause(),root.pro.stop()}),$(".play").on("click",function(){"pause"==audio.status?(audio.play(),root.pro.start(),rotate($(".img-box").attr("data-deg")),$(".play").addClass("playing")):(audio.pause(),root.pro.stop(),clearInterval(timer),$(".play").removeClass("playing"))}),$(".like").on("click",function(){like.islike(songList[newIndex])}),$(".list").on("click",function(){$(".song-list").css({height:"auto"})}),$(".song-list ul li").forEach(function(o,t){o.onclick=function(){$("body").trigger("play:change",t),control=new root.control(len,t),$(".song-list").css({height:"0"}),root.pro.start(0),"pause"==audio.status&&audio.pause(),root.pro.stop()}})}function rotate(o){clearInterval(timer),o=+o,timer=setInterval(function(){o+=2,$(".img-box").attr("data-deg",o),$(".img-box").css({transform:"rotateZ("+o+"deg)",transition:"all 0.2s linear"})},200)}function bindTouch(){var o=$(".pro-wrap").offset(),r=o.left,i=o.width;$(".slider").on("touchstart",function(){root.pro.stop()}).on("touchmove",function(o){var t=(o.changedTouches[0].clientX-r)/i;0<t&&t<1&&root.pro.update(t)}).on("touchend",function(o){var t=(o.changedTouches[0].clientX-r)/i;if(0<t&&t<1){var n=songList[newIndex].duration;$(".play").addClass("playing");var a=t*n;audio.status="play",audio.playTo(a),audio.play(),root.pro.start(t)}})}getData("../mock/data.json");